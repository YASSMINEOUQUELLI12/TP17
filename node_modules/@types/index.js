// 1. Importer les modules nécessaires
const fs = require('fs');
const convert = require('xml-js');
const protobuf = require('protobufjs');

// 2. Charger le fichier .proto et récupérer le type "Employees"
const root = protobuf.loadSync('employee.proto');
const EmployeeList = root.lookupType('Employees');

// 3. Construire la liste d'employés en JavaScript
const employees = [];

employees.push({
  id: 1,
  name: 'Ali',
  salary: 9000
});

employees.push({
  id: 2,
  name: 'Kamal',
  salary: 22000
});

employees.push({
  id: 3,
  name: 'Amal',
  salary: 23000
});

// 4. Construire l’objet racine pour la sérialisation
let jsonObject = {
  employee: employees
};

// --- (Bonus) Sérialisation dans les trois formats ---

// JSON
const jsonData = JSON.stringify(jsonObject, null, 2);
fs.writeFileSync('data.json', jsonData);

// XML
const xmlData = convert.js2xml(jsonObject, { compact: true, spaces: 2 });
fs.writeFileSync('data.xml', xmlData);

// Protobuf
const err = EmployeeList.verify(jsonObject);
if (err) {
  throw Error(err);
}
const message = EmployeeList.create(jsonObject);
const buffer = EmployeeList.encode(message).finish();
fs.writeFileSync('data.protobuf', buffer);

// Afficher les tailles des fichiers
const jsonSize = fs.statSync('data.json').size;
const xmlSize = fs.statSync('data.xml').size;
const protoSize = fs.statSync('data.protobuf').size;

console.log('Taille JSON     :', jsonSize, 'octets');
console.log('Taille XML      :', xmlSize, 'octets');
console.log('Taille Protobuf :', protoSize, 'octets');
